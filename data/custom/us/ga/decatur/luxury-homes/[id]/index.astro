---
import ImageSlider from "../src/astro/components/ImageSlider.astro";
import Default from "../src/astro/components/Default.astro";
import data from "./data.json";
import { generateStaticPaths, findListingById } from "src/scripts/property.details/listing";
import PropertyCard from "src/astro/components/PropertyCard.astro";

export function getStaticPaths() {
  return generateStaticPaths(data);
}

const id = Astro.params.id;
const { mainListing, listing } = findListingById(data, id);
const currentId= Number(Astro.params.id)
---

<Default data={data}>
  <div slot="pageCustom">
    <div id="main-wrapper" class="mainContent">
      <div class="text-content">
        <div class="property-detail-container">
          <!-- Mobile image slider -->
          <ImageSlider gallery={listing.gallery || []}/>

          <!-- Content -->
          <div class="detail-container">
            <div class="left-column">
              <div class="content-header">
                <div class="status">
                  <span class="dot"></span> {mainListing.status}
                </div>
                <h2>{mainListing.price}</h2>
                <p>{mainListing.location}</p>
                <p>{mainListing.subStats}</p>
              </div>
              <div class="separator-dark"></div>
              <div class="content-description">
                <div class="content-left">
                  <ul class="property-stats no-padding">
                    <!-- Add stats as necessary -->
                  </ul>
                </div>
                <div class="content-right">
                  <div class="property-description">
                    <p id="description">
                      {listing.detail_description}
                  </div>
                </div>
              </div>
              <div class="map">
                <h2>Map</h2>
                <iframe
                  src={listing.map.iframe_src}
                  width="100%"
                  height="20%"
                  style="border: 0;"
                  allowfullscreen
                  loading="lazy"
                  referrerpolicy="no-referrer-when-downgrade"
                >
                </iframe>
                <p class="map-address">{listing.location}</p>
              </div>
              <div class="separator-dark"></div>
              <div class="property-details">
                {
                  listing.interior_features && (
                    <div class="feature-details">
                      <div class="feature-title">
                        <img
                          src="https://img.icons8.com/ios/50/sofa.png"
                          alt="sofa"
                          width="20"
                          height="20"
                        />
                        <h3>Interior Features</h3>
                      </div>
                      <ul class="feature-list">
                        {listing.interior_features.map((feature, index) => (
                          <li key={index}>
                            <span class="feature-label">{feature.label}</span>
                            <ul class="feature-value">
                              {feature.value.map((row, rowIndex) => (
                                <li key={rowIndex}>{row}</li>
                              ))}
                            </ul>
                          </li>
                        ))}
                      </ul>
                    </div>
                  )
                }
                {listing.exterior_features && (
                  <div class="feature-details">
                  <div class="feature-title">
                    <img
                    src="https://img.icons8.com/ios/50/exterior.png"
                    alt="exterior"
                    width="20"
                    height="20"
                    />
                    <h3>Exterior/Building Features</h3>
                  </div>
                  <ul class="feature-list">
                    {listing.exterior_features.map((feature, index) => (
                    <li key={index}>
                      <span class="feature-label">{feature.label}</span>
                      <ul class="feature-value">
                      {feature.value.map((row, rowIndex) => (
                        <li key={rowIndex}>{row}</li>
                      ))}
                      </ul>
                    </li>
                    ))}
                  </ul>
                  </div>
                )}
                {listing.additional_info && (
                  <div class="feature-details">
                  <div class="feature-title">
                    <img
                    src="https://img.icons8.com/ios/50/features-list.png"
                    alt="features-list"
                    width="20"
                    height="20"
                    />
                    <h3>Additional Information</h3>
                  </div>
                  <ul class="feature-list">
                    {listing.additional_info.map((feature, index) => (
                    <li key={index}>
                      <span class="feature-label">{feature.label}</span>
                      <ul class="feature-value">
                      {feature.value.map((row, rowIndex) => (
                        <li key={rowIndex}>{row}</li>
                      ))}
                      </ul>
                    </li>
                    ))}
                  </ul>
                  </div>
                )}
              </div>
            </div>
            <div class="right-column">
              <div class="agent-card">
                <div class="agent-details">
                  <h3 class="agent-name">{data.agent.name}</h3>
                  <div class="agent-info">
                    <div class="mobile-info row-info">
                      <p class="label">Mobile number</p>
                      <p class="value">{data.agent.phone}</p>
                    </div>
                    <hr />
                    <div class="email-info row-info">
                      <p class="label">Email</p>
                      <p class="value">{data.agent.email}</p>
                    </div>
                  </div>
                </div>
                <div class="agent-contact">
                  <a
                    href="/us/ga/decatur/real-estate-agents/contact"
                    class="btn-primary">Contact agent</a
                  >
                </div>
              </div>
            </div>
          </div>
          <div class="separator-dark"></div>

          <!-- Similar homes -->
          <div class="related-listings">
            <h2>Similar Properties</h2>
            <div class="related-listings-grid">
              {data.listings.filter(listing => listing.id !== currentId).slice(0, 4).map((listing) => {
                const detail = data.listings_details.find(
                    (detail) => detail.id === listing.id
                );
                return <PropertyCard listing={listing} detail={detail} key={listing.id} />;
            })}
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</Default>
